<!DOCTYPE html>
<html lang="ru">

<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <title>–¶–∏—Ñ—Ä–æ–≤–∞—è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</title>
   <meta name="description"
      content="–ß–∏—Ç–∞–π—Ç–µ –∫–Ω–∏–≥—É {book-title} –æ—Ç {book-author} –æ–Ω–ª–∞–π–Ω —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Ü–≤–µ—Ç–æ–≤ –∏ —Ç–µ–º—ã –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è." />
   <link rel="stylesheet" href="styles/main.css" />
   <link rel="stylesheet" href="styles/reader.css" />
   <link rel="stylesheet" href="styles/reading-settings.css">
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

   <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
   <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
   <link rel="shortcut icon" href="/favicon/favicon.ico" />
   <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
   
   <!-- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–µ–ª—å–∫–∞–Ω–∏—è —Ç–µ–º—ã -->
   <script>
    (function() {
      try {
        const saved = localStorage.getItem('reading-settings');
        if (saved) {
          const settings = JSON.parse(saved);
          const themes = {
            dark: {
              "--reader-background": "#111827",
              "--reader-page": "#1e293b",
              "--reader-text": "#f8fafc",
              "--reader-border": "#111827"
            },
            "dark-blue": {
              "--reader-background": "#171717",
              "--reader-page": "#202124",
              "--reader-text": "#f1f5f9",
              "--reader-border": "#171717"
            },
            "dark-warm": {
              "--reader-background": "#1c1917",
              "--reader-page": "#292524",
              "--reader-text": "#e7e5e4",
              "--reader-border": "#1c1917"
            },
            light: {
              "--reader-background": "#f8fafc",
              "--reader-page": "#ffffff",
              "--reader-text": "#1f2937",
              "--reader-border": "#e5e7eb"
            },
            "light-warm": {
              "--reader-background": "#7e7e8f",
              "--reader-page": "#c6c6d5",
              "--reader-text": "#202020",
              "--reader-border": "#7e7e8f"
            },
            sepia: {
              "--reader-background": "#f5e6d3",
              "--reader-page": "#fdf6e3",
              "--reader-text": "#644339",
              "--reader-border": "#f5e6d3"
            },
            blue: {
              "--reader-background": "#edf2f7",
              "--reader-page": "#e2e8f0",
              "--reader-text": "#2d3748",
              "--reader-border": "#bdc4c8"
            },
            green: {
              "--reader-background": "#e6ddd6",
              "--reader-page": "#faf8f2",
              "--reader-text": "#302d27",
              "--reader-border": "#e6e7e0"
            }
          };
          
          const theme = themes[settings.theme] || themes.dark;
          const brightness = settings.brightness || 1.0;
          const root = document.documentElement;
          
          // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —è—Ä–∫–æ—Å—Ç–∏ —Ü–≤–µ—Ç–∞
          function adjustColorBrightness(color, brightness) {
            const hex = color.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);  
            const b = parseInt(hex.substr(4, 2), 16);
            
            const newR = Math.round(Math.min(255, r * brightness));
            const newG = Math.round(Math.min(255, g * brightness));
            const newB = Math.round(Math.min(255, b * brightness));
            
            const toHex = (n) => n.toString(16).padStart(2, '0');
            return '#' + toHex(newR) + toHex(newG) + toHex(newB);
          }
          
          // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É —Å —è—Ä–∫–æ—Å—Ç—å—é
          Object.keys(theme).forEach(variable => {
            const adjustedColor = adjustColorBrightness(theme[variable], brightness);
            root.style.setProperty(variable, adjustedColor);
          });
        }
      } catch(e) {
        // Ignore errors, fallback to default theme
      }
    })();
   </script>
</head>

<body>
   <div class="theme-toggle-container">
      <button id="theme-toggle" class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
         <i class="fas fa-sun sun-icon"></i>
         <i class="fas fa-moon moon-icon"></i>
      </button>
   </div>
   <!-- Navigation -->
   <nav class="book-nav">
      <div class="nav-content">
         <a href="index.html" class="back-btn" data-testid="button-back-home">
            <i class="fas fa-chevron-left"></i>
            –ù–∞–∑–∞–¥ –∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ
         </a>
      </div>
   </nav>
   <!-- Book Header -->
   <header class="book-header">
      <div class="container">
         <div class="book-header-content">
            <div class="book-cover-large">
               <img id="book-poster" src="/img/poster.jpg" alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏" />
            </div>
            <div class="book-details">
               <h1 class="book-title-large" id="book-title">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏</h1>
               <p class="book-author-large" id="book-author">–ê–≤—Ç–æ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω</p>
               <p class="book-description-large" id="book-description">
                  –û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
               </p>
               <div class="book-actions">
                  <button id="start-reading" class="btn-primary btn-large" data-testid="button-start-reading">
                     <i class="fas fa-book-open"></i>
                     –ù–∞—á–∞—Ç—å —á—Ç–µ–Ω–∏–µ
                  </button>
                  <button id="continue-reading" class="btn-secondary" style="display: none"
                     data-testid="button-continue-reading">
                     <i class="fas fa-arrow-right"></i>
                     –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —á—Ç–µ–Ω–∏–µ
                  </button>

                  <button id="continue-listening" class="btn-secondary" style="display: none"
                     data-testid="button-continue-listening">
                     <i class="fas fa-play"></i>
                     –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–ª—É—à–∞—Ç—å
                  </button>

                  <!-- –ö–ù–û–ü–ö–ê –°–ö–ê–ß–ò–í–ê–ù–ò–Ø –ö–ù–ò–ì–ò -->
                  <a href="#" id="download-book" class="btn-secondary" data-testid="button-download-book">
                     <i class="fas fa-download"></i>
                     –°–∫–∞—á–∞—Ç—å –∫–Ω–∏–≥—É
                  </a>


               </div>
               <div class="reading-progress">
                  <div class="progress-section" id="reading-progress-section">
                     <div class="progress-info">
                        <i class="fas fa-book-open"></i>
                        <span class="progress-label">–ü—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è</span>
                     </div>
                     <div class="progress-bar">
                        <div class="progress-fill" id="reading-progress-fill" style="width: 0%"></div>
                     </div>
                     <span class="progress-text" id="reading-progress-text">0%</span>
                  </div>

                  <div class="progress-section" id="audio-progress-section">
                     <div class="progress-info">
                        <i class="fas fa-headphones"></i>
                        <span class="progress-label">–ü—Ä–æ–≥—Ä–µ—Å—Å –∞—É–¥–∏–æ–∫–Ω–∏–≥–∏</span>
                     </div>
                     <div class="progress-bar">
                        <div class="progress-fill" id="audio-main-progress-fill" style="width: 0%"></div>
                     </div>
                     <span class="progress-text" id="audio-main-progress-text">0%</span>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </header>
   <!-- Audio Section (will be hidden if no audio) -->
   <section class="audio-section" id="audio-section" style="display: none">
      <div class="container">
         <div class="audio-player" id="audio-player">
            <div class="audio-info">
               <h3 id="audio-title">–ê—É–¥–∏–æ–∫–Ω–∏–≥–∞</h3>
               <p id="current-chapter-info">–í—ã–±–µ—Ä–∏—Ç–µ –≥–ª–∞–≤—É –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è</p>
            </div>
            <div class="audio-controls">
               <div class="audio-controls-main">
                  <button id="prev-chapter" class="audio-btn" title="–ü—Ä–µ–¥—ã–¥—É—â–∞—è –≥–ª–∞–≤–∞">
                     <i class="fas fa-step-backward"></i>
                  </button>

                  <button id="play-pause-btn" class="audio-btn" data-testid="button-audio-play">
                     <i class="fas fa-play play-icon"></i>
                     <i class="fas fa-pause pause-icon" style="display: none"></i>
                  </button>

                  <button id="next-chapter" class="audio-btn" title="–°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞">
                     <i class="fas fa-step-forward"></i>
                  </button>

                  <div class="audio-progress">
                     <span id="current-time">0:00</span>
                     <input type="range" id="audio-progress-bar" min="0" max="100" value="0" class="progress-slider" />
                     <span id="total-time">0:00</span>
                  </div>
               </div>

               <div class="volume-controls">
                  <button id="mute-btn" class="audio-btn">
                     <i class="fas fa-volume-up volume-icon"></i>
                     <i class="fas fa-volume-mute mute-icon" style="display: none"></i>
                  </button>
                  <input type="range" id="volume-control" min="0" max="100" value="100" class="volume-slider" />
               </div>
            </div>


         </div>
         <!-- –°–ø–∏—Å–æ–∫ –≥–ª–∞–≤ –∞—É–¥–∏–æ–∫–Ω–∏–≥–∏ -->
         <div class="chapters-list" id="chapters-list">
            <h4>–ì–ª–∞–≤—ã –∞—É–¥–∏–æ–∫–Ω–∏–≥–∏</h4>
            <div class="chapters-grid" id="chapters-grid">
               <!-- –ì–ª–∞–≤—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
         </div>
      </div>
   </section>
   <!-- Text Version Section (shown when no audio) -->
   <section class="text-version-section" id="text-version-section" style="display: none">
      <div class="container">
         <div class="text-version-content">
            <div class="text-version-icon">
               <i class="fas fa-book-reader"></i>
            </div>
            <div class="text-version-info">
               <h3>–¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è</h3>
               <p>
                  –î–ª—è —ç—Ç–æ–π –∫–Ω–∏–≥–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è. –ê—É–¥–∏–æ–∑–∞–ø–∏—Å–∏
                  –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.
               </p>
               <p>
                  –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å–ª–∞–¥–∏—Ç—å—Å—è —á—Ç–µ–Ω–∏–µ–º –∫–Ω–∏–≥–∏ –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π
                  —Ü–≤–µ—Ç–æ–≤ –∏ —à—Ä–∏—Ñ—Ç–æ–≤.
               </p>
            </div>
            <div class="text-version-actions">
               <button id="start-text-reading" class="btn-primary">
                  <i class="fas fa-book-open"></i>
                  –ù–∞—á–∞—Ç—å —á—Ç–µ–Ω–∏–µ
               </button>
            </div>
         </div>
      </div>
   </section>
   <!-- Reading Mode Controls -->
   <div class="reading-mode-controls" id="reading-mode-controls" style="display: none">
      <div class="container">
         <div class="mode-selector">
            <h4>–†–µ–∂–∏–º —á—Ç–µ–Ω–∏—è</h4>
            <div class="mode-buttons">
               <button id="page-mode" class="mode-btn active">
                  <i class="fas fa-file-alt"></i>
                  –°—Ç—Ä–∞–Ω–∏—Ü—ã
               </button>
               <button id="scroll-mode" class="mode-btn">
                  <i class="fas fa-scroll"></i>
                  –ü—Ä–æ–∫—Ä—É—Ç–∫–∞
               </button>
            </div>
         </div>
      </div>
   </div>






   <!-- Full Screen Reading Modal -->
   <div class="reading-modal" id="reading-modal" style="display: none">
      <!-- Fixed Top Menu -->
      <div class="reading-menu">
         <div class="container-menu">
            <div class="reading-menu-left">
               <button id="exit-reading" class="exit-btn back-btn" data-testid="button-exit-reading">
                  <i class="fas fa-chevron-left"></i>
                  –í—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ —á—Ç–µ–Ω–∏—è
               </button>
            </div>
            <div class="reading-menu-center">
               <div class="reading-progress">
                  <div class="progress-bar">
                     <div class="progress-fill" id="reading-modal-progress-fill" style="width: 0%"></div>
                  </div>
                  <span class="progress-text" id="reading-modal-progress-text">0%</span>
               </div>
            </div>
            <div class="reading-menu-right">
               <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ -->
               <button id="fullscreen-toggle" class="menu-btn" title="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º">
                  <i class="fas fa-expand fullscreen-expand"></i>
                  <i class="fas fa-compress fullscreen-compress" style="display: none;"></i>
               </button>
               <button id="reading-color-settings" class="menu-btn settings-btn">
                  <i class="fas fa-cog"></i>
                  –ù–∞—Å—Ç—Ä–æ–∏—Ç—å
               </button>
            </div>
         </div>
      </div>

      <!-- Reading Content -->
      <div class="reading-content">
         <article class="book-content" id="book-content" style="
            background: var(--reader-page, var(--background-primary));
            color: var(--reader-text, var(--text-primary));
          ">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–Ω–∏–≥–∏ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∑–¥–µ—Å—å -->
         </article>
      </div>

      <!-- –°—Ç—Ä–µ–ª–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
      <div class="nav-arrows" style="display: none;">
         <div class="nav-arrow nav-arrow-prev" onclick="window.readingSettings?.prevPage()">
            <i class="fas fa-chevron-left"></i>
         </div>
         <div class="nav-arrow nav-arrow-next" onclick="window.readingSettings?.nextPage()">
            <i class="fas fa-chevron-right"></i>
         </div>
      </div>

      <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü -->
      <div class="page-info" style="display: none;">
         <span id="current-page">1</span> / <span id="total-pages">1</span>
      </div>
   </div>









   <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
   <div class="settings-sidebar" id="settings-sidebar">
      <div class="settings-header">
         <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á—Ç–µ–Ω–∏—è</h3>
         <button class="settings-close" id="settings-close">
            <i class="fas fa-times"></i>
         </button>
      </div>

      <div class="settings-content">

         <!-- –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ -->
         <div class="settings-group">
            <label>–†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞</label>
            <div class="font-controls">
               <div class="font-size-control">
                  <button id="font-size-decrease" class="font-size-btn">
                     <i class="fas fa-minus"></i>
                  </button>
                  <span id="font-size-display">18px</span>
                  <button id="font-size-increase" class="font-size-btn">
                     <i class="fas fa-plus"></i>
                  </button>
               </div>
            </div>
            <div class="font-preview" style="display: none;">
               <p class="font-preview-text">–ü—Ä–∏–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —à—Ä–∏—Ñ—Ç–∞ –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è.
               </p>
            </div>
         </div>

         <!-- –Ø—Ä–∫–æ—Å—Ç—å -->
         <div class="settings-group">
            <label>–Ø—Ä–∫–æ—Å—Ç—å</label>
            <div class="font-controls">
               <div class="brightness-control">
                  <i class="fas fa-sun brightness-icon"></i>
                  <input type="range" id="brightness-slider" min="0.3" max="1.0" step="0.1" value="1.0" class="brightness-slider">
                  <span id="brightness-display">100%</span>
               </div>
            </div>
         </div>

         <!-- –®—Ä–∏—Ñ—Ç -->
         <div class="settings-group">
            <label>–®—Ä–∏—Ñ—Ç</label>
            <select id="font-family-select" class="settings-select">
               <option value="Inter">Inter</option>
               <option value="Arial">Arial</option>
               <option value="Times New Roman">Times New Roman</option>
               <option value="Georgia">Georgia</option>
               <option value="Verdana">Verdana</option>
               <option value="Kazimir">Kazimir</option>
            </select>
         </div>

         <!-- –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ -->
         <div class="settings-group">
            <h4>üìÑ –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞</h4>
            <div class="text-align-buttons">
               <button id="text-align-left" class="setting-btn">
                  <i class="fas fa-align-left"></i>
                  <span>–ü–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é</span>
               </button>
               <button id="text-align-justify" class="setting-btn active">
                  <i class="fas fa-align-justify"></i>
                  <span>–ü–æ —à–∏—Ä–∏–Ω–µ</span>
               </button>
            </div>
         </div>

         <!-- –†–µ–∂–∏–º —á—Ç–µ–Ω–∏—è -->
         <div class="settings-group">
            <h4>üìñ –†–µ–∂–∏–º —á—Ç–µ–Ω–∏—è</h4>
            <div class="reading-mode-buttons">
               <button id="reading-mode-page" class="setting-btn">
                  <i class="fas fa-file-alt"></i>
                  <span>–ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ</span>
               </button>
               <button id="reading-mode-scroll" class="setting-btn active">
                  <i class="fas fa-scroll"></i>
                  <span>–ü—Ä–æ–∫—Ä—É—Ç–∫–∞</span>
               </button>
            </div>
         </div>

         <!-- –¢–µ–º—ã -->
         <div class="setting-group">
            <h4>üé® –¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h4>
            <div class="themes-grid">
               <div class="theme-preset active" data-theme="dark" title="–¢—ë–º–Ω–∞—è">
                  <div class="theme-dot" style="background: linear-gradient(135deg, #111827, #1f2937)"></div>
                  <span class="theme-name">–¢—ë–º–Ω–∞—è</span>
               </div>
               <div class="theme-preset" data-theme="dark-blue" title="–¢—ë–º–Ω–æ-—Å–∏–Ω—è—è">
                  <div class="theme-dot" style="background: linear-gradient(135deg, #0f172a, #1e293b)"></div>
                  <span class="theme-name">–¢—ë–º–Ω–æ-—Å–∏–Ω—è—è</span>
               </div>
               <div class="theme-preset" data-theme="dark-warm" title="–¢—ë–º–Ω–æ-—Ç—ë–ø–ª–∞—è">
                  <div class="theme-dot" style="background: linear-gradient(135deg, #1c1917, #292524)"></div>
                  <span class="theme-name">–¢—ë–ø–ª–∞—è —Ç—ë–º–Ω–∞—è</span>
               </div>
               <div class="theme-preset" data-theme="light" title="–°–≤–µ—Ç–ª–∞—è">
                  <div class="theme-dot" style="background: linear-gradient(135deg, #f8fafc, #ffffff)"></div>
                  <span class="theme-name">–°–≤–µ—Ç–ª–∞—è</span>
               </div>
               <div class="theme-preset" data-theme="light-warm" title="–°–≤–µ—Ç–ª–æ-—Ç—ë–ø–ª–∞—è">
                  <div class="theme-dot" style="background: linear-gradient(135deg, #fdf2f8, #fefce8)"></div>
                  <span class="theme-name">–¢—ë–ø–ª–∞—è —Å–≤–µ—Ç–ª–∞—è</span>
               </div>
               <div class="theme-preset" data-theme="sepia" title="–°–µ–ø–∏—è">
                  <div class="theme-dot" style="background: linear-gradient(135deg, #f5e6d3, #fdf6e3)"></div>
                  <span class="theme-name">–°–µ–ø–∏—è</span>
               </div>
               <div class="theme-preset" data-theme="blue" title="–ì–æ–ª—É–±–∞—è">
                  <div class="theme-dot" style="background: linear-gradient(135deg, #e0f2fe, #f0f9ff)"></div>
                  <span class="theme-name">–ì–æ–ª—É–±–∞—è</span>
               </div>
               <div class="theme-preset" data-theme="green" title="–ó–µ–ª—ë–Ω–∞—è">
                  <div class="theme-dot" style="background: linear-gradient(135deg, #f0fdf4, #ecfdf5)"></div>
                  <span class="theme-name">–ó–µ–ª—ë–Ω–∞—è</span>
               </div>
            </div>
         </div>
      </div>
   </div>



   <!-- Reading Content -->
   <div class="reading-content">
      <article class="book-content" id="book-content" style="
            background: var(--reader-page, var(--background-primary));
            color: var(--reader-text, var(--text-primary));
          ">
         <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–Ω–∏–≥–∏ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∑–¥–µ—Å—å -->
      </article>
   </div>

   <!-- –°—Ç—Ä–µ–ª–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
   <div class="nav-arrows" style="display: none;">
      <div class="nav-arrow nav-arrow-prev" onclick="window.readingSettings?.prevPage()">
         <i class="fas fa-chevron-left"></i>
      </div>
      <div class="nav-arrow nav-arrow-next" onclick="window.readingSettings?.nextPage()">
         <i class="fas fa-chevron-right"></i>
      </div>
   </div>

   <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü -->
   <div class="page-info" style="display: none;">
      <span id="current-page">1</span> / <span id="total-pages">1</span>
   </div>
   </div>

   <!-- Reading Controls -->
   <div class="reading-controls" id="reading-controls" style="display: none">
      <div class="control-buttons">
         <button id="prev-page" class="control-btn" title="–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞">
            <i class="fas fa-chevron-left"></i>
         </button>
         <button id="next-page" class="control-btn" title="–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞">
            <i class="fas fa-chevron-right"></i>
         </button>
         <div class="page-info">
            <span id="current-page">1</span> / <span id="total-pages">1</span>
         </div>
      </div>
   </div>

   <script src="js/book-config.js"></script>
   <script src="js/theme.js"></script>
   <script src="js/audio-player.js"></script>
   <script src="js/book-loader.js"></script>
   <script src="js/reader.js"></script>
   <script src="js/color-customizer.js"></script>
   <script src="js/reading-settings.js"></script>
   <script>



      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
      document.addEventListener("DOMContentLoaded", function () {
         // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á—Ç–µ–Ω–∏—è
         window.readingSettings = new ReadingSettings();

         // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
         setTimeout(() => {
            if (window.readingSettings) {
               console.log("ReadingSettings initialized:",
                  window.readingSettings.currentSettings.readingMode);
            }
         }, 1000);
      });

      function initializeReadingPage() {
         console.log("Initializing reading page...");

         // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á—Ç–µ–Ω–∏—è
         window.readingSettings = new ReadingSettings();

         // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
         setTimeout(() => {
            window.readingSettings.calculatePages();
         }, 1000);

         // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
         window.addEventListener("resize", () => {
            if (
               window.readingSettings &&
               window.readingSettings.currentSettings.readingMode === "page"
            ) {
               window.readingSettings.calculatePages();
               window.readingSettings.showCurrentPage();
            }
         });
      }






      // Book Page Initialization
      document.addEventListener("DOMContentLoaded", function () {
         const bookConfig = window.bookConfig
            ? window.bookConfig.getCurrentBook()
            : null;
         if (bookConfig) {
            // Update page metadata
            document.title = `${bookConfig.title || "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏"
               } - –¶–∏—Ñ—Ä–æ–≤–∞—è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞`;
            // Update book info
            document.getElementById("book-title").textContent =
               bookConfig.title || "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏";
            document.getElementById("book-author").textContent =
               bookConfig.author || "–ê–≤—Ç–æ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω";
            document.getElementById("book-description").textContent =
               bookConfig.description || "–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç";
            // Update poster
            const posterImg = document.getElementById("book-poster");
            posterImg.src =
               bookConfig.poster || "/img/poster.jpg";
            posterImg.alt = `${bookConfig.title || "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏"
               } - –æ–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏`;
            // Set body data attributes
            document.body.setAttribute(
               "data-audio-folder",
               bookConfig.audioFolder || ""
            );
            document.body.setAttribute(
               "data-audio-count",
               bookConfig.audioCount || 0
            );
            document.body.setAttribute(
               "data-book-file",
               bookConfig.bookFile || ""
            );
            document.body.setAttribute(
               "data-book-type",
               bookConfig.bookFormat || ""
            );
            document.body.setAttribute(
               "data-poster-image",
               bookConfig.poster || "/img/poster.jpg"
            );
            // Show/hide audio section based on audio availability
            const audioSection = document.getElementById("audio-section");
            const textVersionSection = document.getElementById(
               "text-version-section"
            );
            if (bookConfig.audioCount && bookConfig.audioCount > 0) {
               audioSection.style.display = "block";
               document.getElementById("audio-title").textContent = `–ê—É–¥–∏–æ–∫–Ω–∏–≥–∞: ${bookConfig.title || "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏"
                  }`;
            } else {
               textVersionSection.style.display = "block";
               // Connect text version button to reading functionality
               document
                  .getElementById("start-text-reading")
                  .addEventListener("click", function () {
                     document.getElementById("start-reading").click();
                  });
            }
            // Update continue button based on progress
            const progress = window.bookReader
               ? window.bookReader.loadReadingProgress()
               : { progress: 0 };
            const continueBtn = document.getElementById("continue-reading");
            if (progress.progress > 5) {
               continueBtn.style.display = "inline-flex";
               continueBtn.textContent = `–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å ${Math.round(
                  progress.progress
               )}%`;
            }
         } else {
            // Fallback if book config not found
            console.error("Book configuration not found");
         }
      });


      // –î–æ–±–∞–≤–∏–º —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –≤ book-initializer.js
      function initializeDownloadMenu(bookConfig) {
         const downloadItems = document.getElementById('download-items');
         const downloadBtn = document.getElementById('download-btn');

         if (!downloadItems || !downloadBtn || !bookConfig) return;

         // –ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –∫–Ω–∏–≥–æ–π
         const bookBasePath = bookConfig.folder + 'book/';
         const bookName = bookConfig.id;

         // –í–æ–∑–º–æ–∂–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤
         const possibleFormats = [
            { ext: 'fb2', icon: 'file-alt', name: 'FB2', type: 'FictionBook' },
            { ext: 'pdf', icon: 'file-pdf', name: 'PDF', type: 'PDF' },
            { ext: 'epub', icon: 'file-epub', name: 'EPUB', type: 'ePub' },
            { ext: 'txt', icon: 'file-text', name: 'TXT', type: 'Text' },
            { ext: 'doc', icon: 'file-word', name: 'DOC', type: 'Word' },
            { ext: 'docx', icon: 'file-word', name: 'DOCX', type: 'Word' }
         ];

         // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
         downloadItems.innerHTML = '';

         // –°—á–µ—Ç—á–∏–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
         let availableFormats = 0;

         // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —Ñ–æ—Ä–º–∞—Ç
         possibleFormats.forEach(format => {
            const filePath = `${bookBasePath}${bookName}.${format.ext}`;

            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –º–µ–Ω—é (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç—ã–π)
            const item = document.createElement('a');
            item.className = 'download-item';
            item.href = filePath;
            item.download = `${bookName}.${format.ext}`;
            item.innerHTML = `
            <i class="fas fa-${format.icon}"></i>
            ${format.name}
            <span class="file-size">~2-5 –ú–ë</span>
        `;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
            checkFileExists(filePath).then(exists => {
               if (exists) {
                  downloadItems.appendChild(item);
                  availableFormats++;

                  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤
                  if (availableFormats === 0) {
                     downloadBtn.style.display = 'none';
                  }
               }
            }).catch(error => {
               console.error(`Error checking file ${filePath}:`, error);
            });
         });

         // –ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤, —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
         setTimeout(() => {
            if (availableFormats === 0) {
               downloadBtn.style.display = 'none';
            } else if (availableFormats === 1) {
               // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ñ–æ—Ä–º–∞—Ç, –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É
               const singleItem = downloadItems.querySelector('.download-item');
               if (singleItem) {
                  downloadBtn.innerHTML = '<i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å ' +
                     singleItem.querySelector('i').className.match(/fa-file-(\w+)/)[1].toUpperCase();
                  downloadBtn.onclick = (e) => {
                     e.preventDefault();
                     window.location.href = singleItem.href;
                  };
                  downloadBtn.style.cursor = 'pointer';
                  document.querySelector('.download-menu').style.display = 'none';
               }
            }
         }, 1000);
      }

      // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
      async function checkFileExists(url) {
         try {
            const response = await fetch(url, { method: 'HEAD' });
            return response.ok;
         } catch (error) {
            return false;
         }
      }





      function initializeDownloadButton(bookConfig) {
         const downloadBtn = document.getElementById('download-book');

         if (!downloadBtn || !bookConfig || !bookConfig.id) {
            if (downloadBtn) {
               downloadBtn.style.display = 'none';
            }
            return;
         }

         const bookId = bookConfig.id;
         const format = bookConfig.bookFormat || 'fb2'; // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∏–ª–∏ fb2 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

         // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
         const bookFilePath = `books-pack/${bookId}/book/${bookId}.${format}`;

         // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã
         downloadBtn.href = bookFilePath;
         downloadBtn.setAttribute('download', `${bookId}.${format}`);

         console.log('Download configured:', bookFilePath);
      }





   </script>
   <style>
      /* Text Version Section Styles */
      .text-version-section {
         background: linear-gradient(135deg,
               var(--background-secondary) 0%,
               var(--background-primary) 100%);
         padding: 3rem 0;
         border-bottom: 1px solid var(--border-color);
      }

      .text-version-content {
         display: flex;
         align-items: center;
         gap: 2rem;
         max-width: 800px;
         margin: 0 auto;
         padding: 2rem;
         background: var(--background-primary);
         border-radius: var(--radius-xl);
         box-shadow: var(--shadow-lg);
         border: 1px solid var(--border-color);
      }

      .text-version-icon {
         font-size: 3rem;
         color: var(--primary-color);
         flex-shrink: 0;
      }

      .text-version-info {
         flex: 1;
      }

      .text-version-info h3 {
         color: var(--text-primary);
         margin-bottom: 1rem;
         font-size: 1.5rem;
      }

      .text-version-info p {
         color: var(--text-secondary);
         margin-bottom: 0.5rem;
         line-height: 1.6;
      }

      .text-version-actions {
         flex-shrink: 0;
      }

      @media (max-width: 768px) {
         .text-version-content {
            flex-direction: column;
            text-align: center;
            padding: 1.5rem;
         }

         .text-version-icon {
            font-size: 2.5rem;
         }
      }

      @media (max-width: 480px) {
         .text-version-section {
            padding: 2rem 0;
         }

         .text-version-content {
            padding: 1rem;
         }

         .text-version-icon {
            font-size: 2rem;
         }
      }
   </style>
</body>

</html>